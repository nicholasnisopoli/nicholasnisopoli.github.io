<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FantaPechino</title>
    <style>
        :root {
            --primary-color: #e63946;
            --secondary-color: #457b9d;
            --light-color: #f1faee;
            --dark-color: #1d3557;
            --accent-color: #a8dadc;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--light-color);
            color: var(--dark-color);
        }
        
        header {
            color: black;
            text-align: center;
            padding: 1.5rem 0;
        }
        
        .logo {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .tagline {
            font-style: italic;
            font-size: 1.2rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 2rem;
            margin-top: 2rem;
        }
        
        .sidebar {
            flex: 1;
            min-width: 250px;
            background-color: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .content {
            flex: 3;
            min-width: 300px;
            background-color: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .sidebar h2, .content h2 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 0.5rem;
        }
        
        .nav-links {
            list-style: none;
        }
        
        .nav-links li {
            margin-bottom: 0.5rem;
        }
        
        .nav-links a {
            display: block;
            padding: 0.5rem;
            text-decoration: none;
            color: var(--dark-color);
            border-radius: 4px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .nav-links a:hover {
            background-color: var(--accent-color);
            padding-left: 1rem;
        }
        
        .contestant-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .contestant-card {
            background-color: var(--light-color);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            transition: transform 0.3s ease;
            cursor: pointer;
            position: relative;
        }
        
        .contestant-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .contestant-img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 1rem;
            background-color: var(--secondary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
        }
        
        .contestant-name {
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .contestant-team {
            font-style: italic;
            color: var(--secondary-color);
            margin-bottom: 0.5rem;
        }
        
        .contestant-value {
            background-color: var(--primary-color);
            color: white;
            border-radius: 20px;
            padding: 0.3rem 0.8rem;
            display: inline-block;
        }
        
        .add-to-team {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .add-to-team:hover {
            background-color: var(--primary-color);
        }
        
        .team-section {
            margin-top: 2rem;
        }
        
        .team-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1rem;
            padding: 1rem;
            background-color: var(--accent-color);
            border-radius: 8px;
        }
        
        .team-member {
            background-color: white;
            border-radius: 8px;
            padding: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .team-member img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .team-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
        }
        
        .team-budget, .team-bonus {
            background-color: var(--dark-color);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 4px;
        }
        
        .rules-section {
            margin-top: 2rem;
        }
        
        .rules-list {
            list-style-position: inside;
            margin-top: 1rem;
        }
        
        .rules-list li {
            margin-bottom: 0.5rem;
            padding-left: 1rem;
        }
        
        .bonus-section {
            margin-top: 2rem;
        }
        
        .bonus-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .bonus-table th, .bonus-table td {
            border: 1px solid #ddd;
            padding: 0.8rem;
            text-align: left;
        }
        
        .bonus-table th {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .bonus-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        .bonus-table tr:hover {
            background-color: var(--accent-color);
        }
        
        .stats-section {
            margin-top: 2rem;
        }
        
        .create-team-btn {
            display: block;
            width: 100%;
            padding: 1rem;
            margin-top: 1rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .create-team-btn:hover {
            background-color: var(--dark-color);
        }
        
        footer {
            background-color: var(--dark-color);
            color: white;
            text-align: center;
            
            margin-top: 2rem;
        }
        
        .social-links {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .social-links a {
            color: white;
            font-size: 1.5rem;
            transition: color 0.3s ease;
        }
        
        .social-links a:hover {
            color: var(--accent-color);
        }
        
        /* Stili per la pagina di classifica */
        .ranking-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .action-bar {
            margin-bottom: 1rem;
        }
        
        .filter-dropdown {
            padding: 0.5rem;
            border-radius: 4px;
            border: 1px solid var(--secondary-color);
            margin-right: 0.5rem;
        }
        
        .ranking-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .ranking-table th, .ranking-table td {
            border: 1px solid #ddd;
            padding: 0.8rem;
            text-align: left;
        }
        
        .ranking-table th {
            background-color: var(--secondary-color);
            color: white;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .ranking-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        .ranking-table tr:hover {
            background-color: var(--accent-color);
        }
        
        .points-badge {
            background-color: var(--primary-color);
            color: white;
            border-radius: 20px;
            padding: 0.3rem 0.8rem;
            display: inline-block;
            font-weight: bold;
        }
        
        .ranking-position {
            font-weight: bold;
            font-size: 1.2rem;
            text-align: center;
        }
        
        .first {
            color: gold;
        }
        
        .second {
            color: silver;
        }
        
        .third {
            color: #cd7f32; /* bronze */
        }
        
        /* Stili per la sezione di assegnazione punti */
        .points-form {
            background-color: var(--light-color);
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 1.5rem;
        }
        
        .points-form h3 {
            margin-bottom: 1rem;
            color: var(--dark-color);
        }
        
        .form-row {
            display: flex;
            margin-bottom: 1rem;
            align-items: center;
        }
        
        .form-label {
            flex: 1;
            margin-right: 1rem;
        }
        
        .form-input {
            flex: 2;
            padding: 0.5rem;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        
        .form-select {
            flex: 2;
            padding: 0.5rem;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        
        .submit-btn {
            padding: 0.8rem 1.5rem;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .submit-btn:hover {
            background-color: var(--primary-color);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .tappa-info {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background-color: var(--accent-color);
            border-radius: 8px;
        }
        
        .history-item {
            margin-bottom: 1rem;
            padding: 1rem;
            background-color: #f9f9f9;
            border-radius: 4px;
            border-left: 4px solid var(--secondary-color);
        }
        
        .history-date {
            color: var(--secondary-color);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        
        .history-action {
            font-weight: bold;
        }
        
        .history-points {
            display: inline-block;
            margin-left: 0.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .content {
                order: -1;
            }
            
            .form-row {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .form-label, .form-input, .form-select {
                width: 100%;
                margin-bottom: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">üåç FantaPechino üåç</div>
    </header>
    
    <div class="container">
        <div class="main-content">
            <!-- <div class="sidebar">
                <h2>Menu</h2>
                <ul class="nav-links">
                    <li><a onclick="showTab('home-tab')">Home</a></li>
                    <li><a onclick="showTab('ranking-tab')">Classifica</a></li>
                    <li><a onclick="showTab('points-tab')">Assegna Punti</a></li>
                    <li><a onclick="showTab('home-tab')">Le mie squadre</a></li>
                    <li><a onclick="showTab('home-tab')">Regolamento</a></li>
                    <li><a onclick="showTab('home-tab')">Bonus/Malus</a></li>
                    <li><a onclick="showTab('home-tab')">Statistiche</a></li>
                    <li><a onclick="showTab('home-tab')">Lega Amici</a></li>
                </ul>
                
                <div class="team-section">
                    <h2>La mia Squadra</h2>
                    <div class="team-preview">
                        <div class="team-member">
                            <div class="contestant-img">üë•</div>
                            <span>Seleziona</span>
                        </div>
                        <div class="team-member">
                            <div class="contestant-img">üë•</div>
                            <span>Seleziona</span>
                        </div>
                        <div class="team-member">
                            <div class="contestant-img">üë•</div>
                            <span>Seleziona</span>
                        </div>
                    </div>
                    <div class="team-stats">
                        <div class="team-budget">Budget: 100 crediti</div>
                        <div class="team-bonus">Bonus: +0</div>
                    </div>
                    <button class="create-team-btn">Crea la tua squadra</button>
                </div>
            </div> -->
            
            <div class="content">
                <div class="tappa-info">
                    <h3>Tappa attuale: 1 - Filippine</h3>
                    <p>Data ultima puntata: 13/03/2025</p>
                </div>
                <!-- Tab Home -->
                <div id="home-tab" class="tab-content active">
                    <h2>I Concorrenti</h2>
                    
                    <div class="contestant-cards">
                        <div class="contestant-card">
                            <div class="contestant-img">üíá</div>
                            <div class="contestant-name">Gli Estetici</div>
                        </div>
                        
                        <div class="contestant-card">
                            <div class="contestant-img">üëØ</div>
                            <div class="contestant-name">Le Sorelle</div>
                        </div>
                        
                        <div class="contestant-card">
                            <div class="contestant-img">üé¨</div>
                            <div class="contestant-name">I Cineasti</div>

                        </div>
                        
                        <div class="contestant-card">
                            <div class="contestant-img">üé≠</div>
                            <div class="contestant-name">Gli Spettacolari</div>
        
                        </div>
                        
                        <div class="contestant-card">
                            <div class="contestant-img">üíÉ</div>
                            <div class="contestant-name">I Primi Ballerini</div>
               
                        </div>
                        
                        <div class="contestant-card">
                            <div class="contestant-img">‚ú®</div>
                            <div class="contestant-name">I Magici</div>
                        </div>
                        
                        <div class="contestant-card">
                            <div class="contestant-img">üèÖ</div>
                            <div class="contestant-name">I Medagliati</div>
                        </div>
                        
                        <div class="contestant-card">
                            <div class="contestant-img">üåä</div>
                            <div class="contestant-name">Le Atlantiche</div>

                        </div>
                        
                        <div class="contestant-card">
                            <div class="contestant-img">ü§ù</div>
                            <div class="contestant-name">I Complici</div>
     
                        </div>
                    </div>
                    
                    
            
                </div>
                
                <!-- Tab Classifica -->
                <div id="ranking-tab">
                    
 
                    
                    <table class="ranking-table">
   
                        <tbody id="saved-data-container">
                            <!-- La tabella verr√† popolata dinamicamente con JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Tab Assegna Punti -->
                <div id="points-tab">
                    <h2>Assegna Punti alle Coppie</h2>
                    <p>Inserisci i punti guadagnati dalle coppie in base alle loro azioni durante l'ultima puntata.</p>
                    
                    <div class="points-form">
                        <h3>Nuova Azione</h3>
                        <form id="points-assignment-form">
                            <div class="form-row">
                                <label class="form-label">Coppia:</label>
                                <select class="form-select" id="couple-select" required>
                                    <option value="">Seleziona una coppia</option>
                                    <option value="Gli Estetici">Gli Estetici</option>
                                    <option value="Le Sorelle">Le Sorelle</option>
                                    <option value="I Cineasti">I Cineasti</option>
                                    <option value="Gli Spettacolari">Gli Spettacolari</option>
                                    <option value="I Primi Ballerini">I Primi Ballerini</option>
                                    <option value="I Magici">I Magici</option>
                                    <option value="I Medagliati">I Medagliati</option>
                                    <option value="Le Atlantiche">Le Atlantiche</option>
                                    <option value="I Complici">I Complici</option>
                                </select>
                            </div>
                            
                            <div class="form-row">
                                <label class="form-label">Azione:</label>
                                <select class="form-select" id="action-select" required>
                                    <option value="">Seleziona un'azione</option>
                                    <option value="Qualificazione prova immunit√†">Qualificazione prova immunit√† (+10)</option>
                                    <option value="Vittoria prova immunit√†">Vittoria prova immunit√† (+20)</option>
                                    <option value="Prima coppia a trovare alloggio per la notte">Prima coppia a trovare alloggio per la notte (+5)</option>
                                    <option value="Coppia vincitrice di tappa">Coppia vincitrice di tappa (+30)</option>
                                    <option value="Qualificazione in finale">Qualificazione in finale (+30)</option>
                                    <option value="Coppia nella finalissima a 2">Coppia nella finalissima a 2 (+50)</option>
                                    <option value="Seconda classificata di Pechino express">Seconda classificata di Pechino express (+75)</option>
                                    <option value="Coppia vincitrice di Pechino Express">Coppia vincitrice di Pechino Express (+100)</option>
                                    <option value="Prima coppia eliminata">Prima coppia eliminata (+20)</option>
                                    <option value="Coppia eliminata ma salvata dalla busta rossa">Coppia eliminata ma salvata dalla busta rossa (+10)</option>
                                    <option value="Abbraccio a Costantino">Abbraccio a Costantino (+5)</option>
                                    <option value="Abbraccio a Fru">Abbraccio a Fru (+5)</option>
                                    <option value="Incontro con connazionale">Incontro con connazionale (+10)</option>
                                    <option value="Alla coppia viene offerto l‚Äôhotel">Alla coppia viene offerto l‚Äôhotel (+10)</option>
                                    <option value="Alla coppia viene pagato il passaggio">Alla coppia viene pagato il passaggio (+10)</option>
                                    <option value="La famiglia ospitante d√† il passaggio la mattina dopo">La famiglia ospitante d√† il passaggio la mattina dopo (+5)</option>
                                    <option value="Il passaggio attende lo svolgersi delle missioni">Il passaggio attende lo svolgersi delle missioni (+5)</option>
                                    <option value="Commozione">Commozione (+5)</option>
                                    <option value="Passaggio condiviso (alla coppia ospitante)">Passaggio condiviso (alla coppia ospitante) (+10)</option>
                                    
                                    <!-- Malus -->
                                    <option value="Passaggio rubato da un‚Äôaltra coppia">Passaggio rubato da un‚Äôaltra coppia (-10)</option>
                                    <option value="Bandiera nera nel corso della tappa">Bandiera nera nel corso della tappa (-5)</option>
                                    <option value="Ultima coppia con bandiera nera">Ultima coppia con bandiera nera (-20)</option>
                                    <option value="Ultima coppia a trovare alloggio per la notte">Ultima coppia a trovare alloggio per la notte (-5)</option>
                                    <option value="Vomito, malessere o infortunio">Vomito, malessere o infortunio (-20)</option>
                                    <option value="Coppia che ripete prova dei 7 mostri">Coppia che ripete prova dei 7 mostri (-10)</option>
                                    <option value="Coppia ultima classificata di tappa">Coppia ultima classificata di tappa (-10)</option>
                                    <option value="La coppia riceve qualsiasi tipo di malus durante la tappa">La coppia riceve qualsiasi tipo di malus durante la tappa (-5)</option>
                                    <option value="I membri della coppia litigano tra loro">I membri della coppia litigano tra loro (-5)</option>
                                    <option value="Coppia perde la mappa">Coppia perde la mappa (-30)</option>
                                    <option value="Costretto ad abbandonare il gioco">Costretto ad abbandonare il gioco (-50)</option>
                                    <option value="Rifiuto prova">Rifiuto prova (-30)</option>
                                    <option value="Ammonizione Costantino">Ammonizione Costantino (-10)</option>
                                    <option value="A rischio eliminazione">A rischio eliminazione (-10)</option>
                                    
                                </select>
                            </div>
                            
                            <div class="form-row">
                                <label class="form-label">Tappa:</label>
                                <select class="form-select" id="tappa-select" required>
                                    <option value="Tappa 1">Tappa 1</option>
                                    <option value="Tappa 2">Tappa 2</option>
                                    <option value="Tappa 3" selected>Tappa 3</option>
                                </select>
                            </div>
                            
                            <div class="form-row">
                                <label class="form-label">Data:</label>
                                <input type="date" class="form-input" id="action-date" value="2025-03-02" required>
                            </div>
                            
                            <div class="form-row">
                                <label class="form-label">Note (opzionale):</label>
                                <input type="text" class="form-input" id="action-notes" placeholder="Inserisci eventuali note...">
                            </div>
                            
                            <button type="submit" class="submit-btn">Salva Punti</button>
                        </form>
                    </div>
                    
                    <div class="bonus-section">
                        <h2>Bonus e Malus</h2>
                        <table class="bonus-table">
                            <thead>
                                <tr>
                                    <th>Azione</th>
                                    <th>Punti</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Qualificazione prova immunit√†</td>
                                    <td>+10</td>
                                </tr>
                                <tr>
                                    <td>Vittoria prova immunit√†</td>
                                    <td>+20</td>
                                </tr>
                                <tr>
                                    <td>Prima coppia a trovare alloggio per la notte</td>
                                    <td>+5</td>
                                </tr>
                                <tr>
                                    <td>Coppia vincitrice di tappa</td>
                                    <td>+30</td>
                                </tr>
                                <tr>
                                    <td>Qualificazione in finale</td>
                                    <td>+30</td>
                                </tr>
                                <tr>
                                    <td>Coppia nella finalissima a 2</td>
                                    <td>+50</td>
                                </tr>
                                <tr>
                                    <td>Seconda classificata di Pechino express</td>
                                    <td>+75</td>
                                </tr>
                                <tr>
                                    <td>Coppia vincitrice di Pechino Express</td>
                                    <td>+100</td>
                                </tr>
                                <tr>
                                    <td>Prima coppia eliminata</td>
                                    <td>+20</td>
                                </tr>
                                <tr>
                                    <td>Coppia eliminata ma salvata dalla busta rossa</td>
                                    <td>+10</td>
                                </tr>
                                <tr>
                                    <td>Abbraccio a Costantino</td>
                                    <td>+5</td>
                                </tr>
                                <tr>
                                    <td>Abbraccio a Fru</td>
                                    <td>+5</td>
                                </tr>
                                <tr>
                                    <td>Incontro con connazionale</td>
                                    <td>+10</td>
                                </tr>
                                <tr>
                                    <td>Alla coppia viene offerto l‚Äôhotel</td>
                                    <td>+10</td>
                                </tr>
                                <tr>
                                    <td>Alla coppia viene pagato il passaggio</td>
                                    <td>+10</td>
                                </tr>
                                <tr>
                                    <td>La famiglia ospitante d√† il passaggio la mattina dopo</td>
                                    <td>+5</td>
                                </tr>
                                <tr>
                                    <td>Il passaggio attende lo svolgersi delle missioni</td>
                                    <td>+5</td>
                                </tr>
                                <tr>
                                    <td>Commozione</td>
                                    <td>+5</td>
                                </tr>
                                <tr>
                                    <td>Passaggio condiviso (alla coppia ospitante)</td>
                                    <td>+10</td>
                                </tr>
                                <tr>
                                    <td>Passaggio rubato da un‚Äôaltra coppia</td>
                                    <td>-10</td>
                                </tr>
                                <tr>
                                    <td>Bandiera nera nel corso della tappa</td>
                                    <td>-5</td>
                                </tr>
                                <tr>
                                    <td>Ultima coppia con bandiera nera</td>
                                    <td>-20</td>
                                </tr>
                                <tr>
                                    <td>Ultima coppia a trovare alloggio per la notte</td>
                                    <td>-5</td>
                                </tr>
                                <tr>
                                    <td>Vomito, malessere o infortunio</td>
                                    <td>-20</td>
                                </tr>
                                <tr>
                                    <td>Coppia che ripete prova dei 7 mostri</td>
                                    <td>-10</td>
                                </tr>
                                <tr>
                                    <td>Coppia ultima classificata di tappa</td>
                                    <td>-10</td>
                                </tr>
                                <tr>
                                    <td>La coppia riceve qualsiasi tipo di malus durante la tappa</td>
                                    <td>-5</td>
                                </tr>
                                <tr>
                                    <td>I membri della coppia litigano tra loro</td>
                                    <td>-5</td>
                                </tr>
                                <tr>
                                    <td>Coppia perde la mappa</td>
                                    <td>-30</td>
                                </tr>
                                <tr>
                                    <td>Costretto ad abbandonare il gioco</td>
                                    <td>-50</td>
                                </tr>
                                <tr>
                                    <td>Rifiuto prova</td>
                                    <td>-30</td>
                                </tr>
                                <tr>
                                    <td>Ammonizione Costantino</td>
                                    <td>-10</td>
                                </tr>
                                <tr>
                                    <td>A rischio eliminazione</td>
                                    <td>-10</td>
                                </tr>                                
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <p>&copy; 2025 FantaPechino - Il gioco non ufficiale di Pechino Express</p>
        <div class="social-links">
            <a href="#">üì±</a>
            <a href="#">üí¨</a>
            <a href="#">üì∏</a>
        </div>
    </footer>

    <script type="module">
          // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
  import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyBok_FwYyiDQ42X8LM8oAr7-lKrCDuPW8o",
    authDomain: "pechino-c5c66.firebaseapp.com",
    projectId: "pechino-c5c66",
    storageBucket: "pechino-c5c66.firebasestorage.app",
    messagingSenderId: "761661899518",
    appId: "1:761661899518:web:da75eb4c6b5ed53ef81baf",
    databaseURL: "https://pechino-c5c66-default-rtdb.europe-west1.firebasedatabase.app/"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  let formData = [];

function saveToFirebase(data) {
  // Save data to Firebase
  set(ref(db, data.id.toString()), data)
    .then(() => {
      console.log("Data saved successfully!");
      // Reload the data after saving
      loadDataFromFirebase();
    })
    .catch(error => {
      console.error("Error saving data:", error);
    });
}

function loadDataFromFirebase() {
  const dbRef = ref(db);
  get(dbRef).then(snapshot => {
    if (snapshot.exists()) {
      const data = snapshot.val();
      formData = []; // Clear existing data
      
      // Convert Firebase object to array
      for (const key in data) {
        if (data.hasOwnProperty(key)) {
          formData.push(data[key]);
        }
      }
      
      // Update both tables
      displayFormData();
    } else {
      console.log("No data available.");
      formData = [];
      displayFormData();
    }
  }).catch(error => console.error("Error loading data:", error));
}

// Function to calculate total points for each couple
function calculateTotalPoints() {
  const totals = {};
  
  formData.forEach(entry => {
    if (!totals[entry.couple]) {
      totals[entry.couple] = 0;
    }
    totals[entry.couple] += entry.points;
  });
  
  return totals;
}

// Function to display the saved data
function displayFormData() {
  const dataContainer = document.getElementById('saved-data-container');
  
  if (!dataContainer) {
    console.error('Data container not found');
    return;
  }
  
  if (formData.length === 0) {
    dataContainer.innerHTML = '<tr><td colspan="3">Nessun dato salvato.</td></tr>';
    return;
  }
  
  // Calculate totals
  const totals = calculateTotalPoints();
  
  // Sort couples by points (descending)
  const sortedCouples = Object.keys(totals).sort((a, b) => totals[b] - totals[a]);
  
  // Create standings table HTML
  let standingsHtml = '';
  
  sortedCouples.forEach((couple, index) => {
    const position = index + 1;
    let positionClass = '';
    
    if (position === 1) positionClass = 'first';
    else if (position === 2) positionClass = 'second';
    else if (position === 3) positionClass = 'third';
    
    standingsHtml += `
      <tr>
        <td class="ranking-position ${positionClass}">${position}</td>
        <td>${couple}</td>
        <td><span class="points-badge">${totals[couple]}</span></td>
      </tr>
    `;
  });
  
  // Update the standings table
  dataContainer.innerHTML = standingsHtml;
  
  // Now handle the events table
  const eventsTableContainer = document.getElementById('events-table-container');
  
  // If events container doesn't exist, create it
  if (!eventsTableContainer) {
    const eventsSection = document.createElement('div');
    eventsSection.id = 'events-section';
    eventsSection.classList.add('stats-section');
    
    eventsSection.innerHTML = `
      <h2>Registro Eventi</h2>
      <table class="ranking-table events-table">
        <thead>
          <tr>
            <th>Data</th>
            <th>Coppia</th>
            <th>Tappa</th>
            <th>Azione</th>
            <th>Punti</th>
            <th>Note</th>
            <th>Azioni</th>
          </tr>
        </thead>
        <tbody id="events-table-container">
        </tbody>
      </table>
    `;
    
    // Add events section after the ranking tab
    const rankingTab = document.getElementById('ranking-tab');
    rankingTab.parentNode.insertBefore(eventsSection, rankingTab.nextSibling);
  }
  
  // Get the events container again (it might have been created)
  const eventsContainer = document.getElementById('events-table-container');
  
  if (eventsContainer) {
    // Sort events by date (most recent first)
    const sortedEvents = [...formData].sort((a, b) => new Date(b.date) - new Date(a.date));
    
    let eventsHtml = '';
    
    sortedEvents.forEach(entry => {
      const formattedDate = new Date(entry.date).toLocaleDateString('it-IT');
      
      eventsHtml += `
        <tr>
          <td>${formattedDate}</td>
          <td>${entry.couple}</td>
          <td>${entry.tappa}</td>
          <td>${entry.action}</td>
          <td class="${entry.points >= 0 ? 'positive' : 'negative'}">${entry.points >= 0 ? '+' : ''}${entry.points}</td>
          <td>${entry.notes || '-'}</td>
          <td>
            <button class="delete-btn" onclick="deleteEntry('${entry.id}')">Elimina</button>
          </td>
        </tr>
      `;
    });
    
    eventsContainer.innerHTML = eventsHtml;
  }
}

// Function to delete an entry
function deleteEntry(entryId) {
  // Remove from Firebase
  set(ref(db, entryId.toString()), null)
    .then(() => {
      console.log("Entry deleted successfully!");
      // Reload the data
      loadDataFromFirebase();
    })
    .catch(error => {
      console.error("Error deleting entry:", error);
    });
}

// Expose functions to global scope for event handlers
window.deleteEntry = deleteEntry;

// Points values mapping
const pointsValues = {
  "Qualificazione prova immunit√†": +10,
  "Vittoria prova immunit√†": +20,
  "Prima coppia a trovare alloggio per la notte": +5,
  "Coppia vincitrice di tappa": +30,
  "Qualificazione in finale": +30,
  "Coppia nella finalissima a 2": +50,
  "Seconda classificata di Pechino express": +75,
  "Coppia vincitrice di Pechino Express": +100,
  "Prima coppia eliminata": +20,
  "Coppia eliminata ma salvata dalla busta rossa": +10,
  "Abbraccio a Costantino": +5,
  "Abbraccio a Fru": +5,
  "Incontro con connazionale": +10,
  "Alla coppia viene offerto l'hotel": +10,
  "Alla coppia viene pagato il passaggio": +10,
  "La famiglia ospitante d√† il passaggio la mattina dopo": +5,
  "Il passaggio attende lo svolgersi delle missioni": +5,
  "Commozione": +5,
  "Passaggio condiviso (alla coppia ospitante)": +10,

  // Malus
  "Passaggio rubato da un'altra coppia": -10,
  "Bandiera nera nel corso della tappa": -5,
  "Ultima coppia con bandiera nera": -20,
  "Ultima coppia a trovare alloggio per la notte": -5,
  "Vomito, malessere o infortunio": -20,
  "Coppia che ripete prova dei 7 mostri": -10,
  "Coppia ultima classificata di tappa": -10,
  "La coppia riceve qualsiasi tipo di malus durante la tappa": -5,
  "I membri della coppia litigano tra loro": -5,
  "Coppia perde la mappa": -30,
  "Costretto ad abbandonare il gioco": -50,
  "Rifiuto prova": -30,
  "Ammonizione Costantino": -10,
  "A rischio eliminazione": -10
};

// Function to handle form submission
document.addEventListener('DOMContentLoaded', function() {
  document.getElementById('points-assignment-form').addEventListener('submit', function(event) {
    event.preventDefault();
    
    // Get form values
    const couple = document.getElementById('couple-select').value;
    const action = document.getElementById('action-select').value;
    const tappa = document.getElementById('tappa-select').value;
    const date = document.getElementById('action-date').value;
    const notes = document.getElementById('action-notes').value;
    
    // Extract points value from the action
    const actionName = action.split(' (')[0]; // Remove the points info from display
    const points = pointsValues[actionName] || 0;
    
    // Create data entry
    const entry = {
      id: Date.now().toString(), // Unique ID for each entry
      couple,
      action: actionName,
      points,
      tappa,
      date,
      notes,
      timestamp: new Date().toISOString()
    };
    
    // Save to Firebase
    saveToFirebase(entry);
    
    // Reset form
    this.reset();
    
    // Set default values again
    document.getElementById('tappa-select').value = 'Tappa 3';
    document.getElementById('action-date').value = '2025-03-02';
  });

  // Tab navigation functions
  window.showTab = function(tabId) {
    // Hide all tabs
    document.querySelectorAll('.tab-content').forEach(tab => {
      tab.classList.remove('active');
    });
    
    // Show the selected tab
    document.getElementById(tabId).classList.add('active');
  };

  // Load data when page loads
  loadDataFromFirebase();
});
        </script>
</body>
